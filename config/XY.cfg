##############################################
############### X/Y Settings #################
##############################################


[stepper_x]
step_pin: gpio11
## Refer to https://docs.vorondesign.com/build/startup/#v0
dir_pin: gpio10                                                     # Check motor direction in link above. If inverted, add a ! before gpio10
enable_pin: !gpio12
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 200                                        # Set to 400 for 0.9° degree stepper motor, 200 is for 1.8° stepper motors
endstop_pin: ^gpio4                                                 # LDO Picobilical overrides this setting 
position_endstop: 120
position_max: 120
homing_speed: 70                                                  # Can be increased after initial setup, Max 100
#homing_retract_dist: 60
use_sensorless_homing: true
min_home_dist: 0
homing_positive_dir: true
endstop_pin: tmc2209_stepper_x:virtual_endstop


[tmc2209 stepper_x]
uart_pin: gpio9
tx_pin: gpio8
diag_pin: ^gpio4
uart_address: 0
interpolate: true
run_current: 0.5
home_current: 0.4
sense_resistor: 0.110
stealthchop_threshold: 0                                            # Set to 999999 to turn stealthchop on, and 0 to use spreadcycle
#driver_SGTHRS: 90  #Tune this, use the highest value that will not cause a false trigger

[autotune_tmc stepper_x]
motor: ldo-35sth52-1504ah
sg4_thrs: 120

[stepper_y]
step_pin: gpio6
## Refer to https://docs.vorondesign.com/build/startup/#v0
dir_pin: gpio5                                                      # Check motor direction in link above. If inverted, add a ! before gpio5
enable_pin: !gpio7
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 200                                        # Set to 400 for 0.9° degree stepper motor, 200 is for 1.8° stepper motors
endstop_pin: ^gpio3
position_endstop: 120
position_max: 120
homing_speed: 70                                                    # Can be increased after initial setup, Max 100
#homing_retract_dist: 60
use_sensorless_homing: true
min_home_dist: 0
homing_positive_dir: true
endstop_pin: tmc2209_stepper_y:virtual_endstop

[tmc2209 stepper_y]
uart_pin: gpio9
tx_pin: gpio8
diag_pin: ^gpio3
uart_address: 2
interpolate: true
run_current: 0.5
home_current: 0.4
sense_resistor: 0.110
stealthchop_threshold: 0                                            # Set to 999999 to turn stealthchop on, and 0 to use spreadcycle

[autotune_tmc stepper_y]
motor: ldo-35sth52-1504ah
sg4_thrs: 120




#[gcode_macro _HOME_X]
#gcode:
    # Always use consistent run_current on A/B steppers during sensorless homing
    #{% set RUN_CURRENT_X = printer.configfile.settings['tmc2209 stepper_x'].run_current|float %}
    #{% set RUN_CURRENT_Y = printer.configfile.settings['tmc2209 stepper_y'].run_current|float %}
    #{% set HOME_CURRENT = 0.7 %}
    #SET_TMC_CURRENT STEPPER=stepper_x CURRENT={HOME_CURRENT}
    #SET_TMC_CURRENT STEPPER=stepper_y CURRENT={HOME_CURRENT}
    #SAVE_GCODE_STATE NAME=STATE_HOME_X

    # Home
    #G28 X
    # Move away
    #G91
    #G1 X-5 F1200

    # Wait just a second… (give StallGuard registers time to clear)
    #G4 P500
    # Set current during print
    #SET_TMC_CURRENT STEPPER=stepper_x CURRENT={RUN_CURRENT_X}
    #SET_TMC_CURRENT STEPPER=stepper_y CURRENT={RUN_CURRENT_Y}
    #RESTORE_GCODE_STATE NAME=STATE_HOME_X

#[gcode_macro _HOME_Y]
#gcode:
    # Set current for sensorless homing
    #{% set RUN_CURRENT_X = printer.configfile.settings['tmc2209 stepper_x'].run_current|float %}
    #{% set RUN_CURRENT_Y = printer.configfile.settings['tmc2209 stepper_y'].run_current|float %}
    #{% set HOME_CURRENT = 0.7 %}
    #SET_TMC_CURRENT STEPPER=stepper_x CURRENT={HOME_CURRENT}
    #SET_TMC_CURRENT STEPPER=stepper_y CURRENT={HOME_CURRENT}
    #SAVE_GCODE_STATE NAME=STATE_HOME_Y

    # Home
    #G28 Y
    # Move away
    #G91
    #G1 Y-5 F1200

    # Wait just a second… (give StallGuard registers time to clear)
    #G4 P500
    # Set current during print
    #SET_TMC_CURRENT STEPPER=stepper_x CURRENT={RUN_CURRENT_X}
    #SET_TMC_CURRENT STEPPER=stepper_y CURRENT={RUN_CURRENT_Y}
    #RESTORE_GCODE_STATE NAME=STATE_HOME_Y
